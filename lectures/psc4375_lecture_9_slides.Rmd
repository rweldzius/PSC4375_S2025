---
title: "PSC4375: Boxplots and QQ-plots"
subtitle: "Week 4: Lecture 9"
author: "Prof. Weldzius"
institute: "Villanova University"
date: "Slides Updated: `r Sys.Date()`"
output:
  beamer_presentation:
    theme: "CambridgeUS"
    colortheme: "seahorse"
    fonttheme: "structurebold"
---

```{css,echo = F}
.small .remark-code { /*Change made here*/
  font-size: 85% !important;
}
.tiny .remark-code { /*Change made here*/
  font-size: 50% !important;
}
```

```{r,include=F}
set.seed(123)
options(width=60)
knitr::opts_chunk$set(fig.align='center',fig.width=9,fig.height=5,message=F,warning=F)
def.chunk.hook  <- knitr::knit_hooks$get("chunk")
knitr::knit_hooks$set(chunk = function(x, options) {
  x <- def.chunk.hook(x, options)
  ifelse(options$size != "normalsize", paste0("\n \\", options$size,"\n\n", x, "\n\n \\normalsize"), x)
})
```

# Assassination attempts

  - Load the assassination attempts data; see the possible attempt results
  
```{r}
library(tidyverse)
data(leaders, package = "qss")
unique(leaders$result)
```

--- 

# Creating an attempt fatal variable

  - use `ifelse` to create a `fatal` variable

```{r}
## create new vector of unique results of "result" 
lev <- unique(leaders$result)
leaders <- leaders %>%
  mutate(fatal = ifelse(result %in% lev[c(2,7,8,10)], 1,0))
leaders %>%
  summarize(mean(fatal))
```

---

# Remember boxplots?

```{r, echo=F, fig.width=3.5, fig.height=2.5}
leaders %>%
  ggplot(aes(y = politybefore)) + 
  geom_boxplot() +
  scale_y_continuous(breaks = seq(-10, 10,by = 5)) + 
  xlim(-.75,.75) + 
  labs(title = "Pre-Attempt Democracy Level", y = "Pre-Attempt Polity Score") +
  theme_bw() + 
  theme(axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank())
```

---

# Comparing distribution with the boxpot

  - What if we want to know how the distribution varies by success?

```{r, echo=F, fig.width=3.5, fig.height=2.5}
leaders %>%
  ggplot(aes(y = politybefore, x = factor(fatal,labels = c("Survived", "Died")))) + 
  geom_boxplot() +
  scale_y_continuous(breaks = seq(-10, 10,by = 5)) + 
  labs(title = "Pre-attempt Democracy Level by Attempt Outcome", y = "Pre-Attempt Polity Score", x = "Assassination Attempt Outcome") +
  theme_bw() +
  theme(plot.title = element_text(size=9),
        axis.title.x = element_text(size = 9),
        axis.title.y = element_text(size = 9),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank())
```

---

# Boxplot comparisons in R

```{r, echo=T, fig.show='hide'}
leaders %>%
  ggplot(aes(y = politybefore, 
             x = factor(fatal,labels = c("Survived", "Died")))) + 
  geom_boxplot() +
  scale_y_continuous(breaks = seq(-10, 10,by = 5)) + 
  labs(title = "Pre-attempt Democracy Level by Attempt Outcome", 
       y = "Pre-Attempt Polity Score", 
       x = "Assassination Attempt Outcome") +
  theme_bw() +
  theme(plot.title = element_text(size=9),
        axis.title.x = element_text(size = 9),
        axis.title.y = element_text(size = 9),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank())
```

---

# Quantile-Quantile Plot

  - How do we compare distributions of two variables that are not in the same dataset?
    - Could use boxplots, but it's only a crude summary of the distributions.
  - **Quantile-quantile plot (Q-Q plot)**: scatterplot of **quantiles**
    - (min of $X$, min of $Y$)
    - (median of $X$, median of $Y$)
    - (25th percentile of $X$, 25th percentile of $Y$)
  - Intuitions:
    - If distributions are the same $\rightsquigarrow$ all points on a 45-degree line
    - Points above 45$^{\circ}$ line $\rightsquigarrow$ y-axis variable has larger value of the quantile
    - Point below 45$^{\circ}$ line $\rightsquigarrow$ x-axis variable has larger value of the quantile
    - Steeper slope than 45$^{\circ}$ line $\rightsquigarrow$ y-axis variable has more spread
    - Flatter slope than 45$^{\circ}$ line $\rightsquigarrow$ x-axis variable has more spread
    
---

# QQ-plot example

```{r, echo=F, fig.width=4, fig.height=3}
leaders <- leaders %>%
  mutate(polity_change = polityafter - politybefore,
         polity_change_f = ifelse(fatal==1,polity_change,NA),
         polity_change_nf = ifelse(fatal==0,polity_change,NA))

quantile_probs <- seq(from = 0, to = 1, by = 0.01)
quantile_names <- as.character(quantile_probs)

quantiles <- leaders %>%
  group_by(fatal) %>%
  summarize(politychng_quantile = quantile(polity_change, probs = quantile_probs),
            quantile = quantile_names) %>%
  pivot_wider(names_from = fatal,
              values_from = politychng_quantile) 
  

quantiles %>%
  ggplot(aes(x = `0`, 
             y = `1`)) + 
  geom_point(shape = 1) +
  geom_abline(intercept = 0, slope = 1, linetype = "dashed") +
  scale_y_continuous(breaks = seq(-20, 15,by = 5)) +
  scale_x_continuous(breaks = seq(-20, 15,by = 5)) +
  labs(title = "Change in Polity: Leader Survived vs. Leader Died", 
       y = "Change in Polity, Leader Died",
       x = "Change in Polity, Leader Died") +
  theme_bw() +
  theme(plot.title = element_text(size=9),
        axis.title.x = element_text(size = 9),
        axis.title.y = element_text(size = 9))
```

---

# QQ-plot example (setup)

```{r, echo=T, results='hide'}
## calculate change in polity
leaders <- leaders %>%
  mutate(polity_change = polityafter - politybefore)

## set quantile vectors
quantile_probs <- seq(from = 0, to = 1, by = 0.01)
quantile_names <- as.character(quantile_probs)

## generate dataframe for plot
quantiles <- leaders %>%
  group_by(fatal) %>%
  summarize(politychng_quantile = quantile(polity_change, probs = quantile_probs),
            quantile = quantile_names) %>%
  pivot_wider(names_from = fatal,
              values_from = politychng_quantile) 
```


---

# QQ-plot example (plot)

```{r, echo=T, fig.show='hide'}
quantiles %>%
  ggplot(aes(x = `0`, y = `1`)) + 
  geom_point(shape = 1) +
  geom_abline(intercept = 0, slope = 1, linetype = "dashed") +
  scale_y_continuous(breaks = seq(-20, 15,by = 5)) +
  scale_x_continuous(breaks = seq(-20, 15,by = 5)) +
  labs(title = "Change in Polity: Leader Survived vs. Leader Died", 
       y = "Change in Polity, Leader Died",
       x = "Change in Polity, Leader Died") +
  theme_bw() +
  theme(plot.title = element_text(size=9),
        axis.title.x = element_text(size = 9),
        axis.title.y = element_text(size = 9))
```



  
  